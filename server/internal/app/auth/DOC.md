<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# auth

```go
import "github.com/Epitech-2nd-Year-Projects/AREA/server/internal/app/auth"
```

## Index

- [Variables](<#variables>)
- [type Clock](<#Clock>)
- [type Config](<#Config>)
- [type CookieConfig](<#CookieConfig>)
- [type EmailChangeResult](<#EmailChangeResult>)
- [type Handler](<#Handler>)
  - [func NewHandler\(service \*Service, oauth \*OAuthService, cookies CookieConfig\) \*Handler](<#NewHandler>)
  - [func \(h \*Handler\) AdminResetUserPassword\(c \*gin.Context, userID openapitypes.UUID\)](<#Handler.AdminResetUserPassword>)
  - [func \(h \*Handler\) AdminUpdateUserEmail\(c \*gin.Context, userID openapitypes.UUID\)](<#Handler.AdminUpdateUserEmail>)
  - [func \(h \*Handler\) AdminUpdateUserStatus\(c \*gin.Context, userID openapitypes.UUID\)](<#Handler.AdminUpdateUserStatus>)
  - [func \(h \*Handler\) AuthorizeOAuth\(c \*gin.Context, provider string\)](<#Handler.AuthorizeOAuth>)
  - [func \(h \*Handler\) ChangeEmail\(c \*gin.Context\)](<#Handler.ChangeEmail>)
  - [func \(h \*Handler\) ChangePassword\(c \*gin.Context\)](<#Handler.ChangePassword>)
  - [func \(h \*Handler\) ExchangeOAuth\(c \*gin.Context, provider string\)](<#Handler.ExchangeOAuth>)
  - [func \(h \*Handler\) GetCurrentUser\(c \*gin.Context\)](<#Handler.GetCurrentUser>)
  - [func \(h \*Handler\) ListIdentities\(c \*gin.Context\)](<#Handler.ListIdentities>)
  - [func \(h \*Handler\) ListServiceProviders\(c \*gin.Context\)](<#Handler.ListServiceProviders>)
  - [func \(h \*Handler\) ListServiceSubscriptions\(c \*gin.Context\)](<#Handler.ListServiceSubscriptions>)
  - [func \(h \*Handler\) Login\(c \*gin.Context\)](<#Handler.Login>)
  - [func \(h \*Handler\) Logout\(c \*gin.Context\)](<#Handler.Logout>)
  - [func \(h \*Handler\) RegisterUser\(c \*gin.Context\)](<#Handler.RegisterUser>)
  - [func \(h \*Handler\) SubscribeService\(c \*gin.Context, provider string\)](<#Handler.SubscribeService>)
  - [func \(h \*Handler\) SubscribeServiceExchange\(c \*gin.Context, provider string\)](<#Handler.SubscribeServiceExchange>)
  - [func \(h \*Handler\) UnsubscribeService\(c \*gin.Context, provider string\)](<#Handler.UnsubscribeService>)
  - [func \(h \*Handler\) VerifyEmail\(c \*gin.Context\)](<#Handler.VerifyEmail>)
- [type LoginResult](<#LoginResult>)
- [type Metadata](<#Metadata>)
- [type OAuthService](<#OAuthService>)
  - [func NewOAuthService\(providers ProviderResolver, identities identityport.Repository, users outbound.UserRepository, sessions outbound.SessionRepository, serviceProviders outbound.ServiceProviderRepository, subscriptions outbound.SubscriptionRepository, clock Clock, logger \*zap.Logger, cfg Config\) \*OAuthService](<#NewOAuthService>)
  - [func \(s \*OAuthService\) AuthorizationURL\(ctx context.Context, provider string, req identityport.AuthorizationRequest\) \(identityport.AuthorizationResponse, error\)](<#OAuthService.AuthorizationURL>)
  - [func \(s \*OAuthService\) BeginSubscription\(ctx context.Context, user userdomain.User, provider string, req identityport.AuthorizationRequest\) \(SubscriptionInitResult, error\)](<#OAuthService.BeginSubscription>)
  - [func \(s \*OAuthService\) CompleteSubscription\(ctx context.Context, user userdomain.User, provider string, code string, req identityport.ExchangeRequest\) \(subscriptiondomain.Subscription, identitydomain.Identity, error\)](<#OAuthService.CompleteSubscription>)
  - [func \(s \*OAuthService\) Exchange\(ctx context.Context, provider string, code string, req identityport.ExchangeRequest, meta Metadata\) \(LoginResult, identitydomain.Identity, error\)](<#OAuthService.Exchange>)
  - [func \(s \*OAuthService\) LinkService\(ctx context.Context, user userdomain.User, provider string, code string, req identityport.ExchangeRequest\) \(subscriptiondomain.Subscription, identitydomain.Identity, error\)](<#OAuthService.LinkService>)
  - [func \(s \*OAuthService\) ListIdentities\(ctx context.Context, userID uuid.UUID\) \(\[\]identitydomain.Identity, error\)](<#OAuthService.ListIdentities>)
  - [func \(s \*OAuthService\) ListProviders\(ctx context.Context\) \(\[\]servicedomain.Provider, error\)](<#OAuthService.ListProviders>)
  - [func \(s \*OAuthService\) ListSubscriptions\(ctx context.Context, userID uuid.UUID\) \(\[\]SubscriptionOverview, error\)](<#OAuthService.ListSubscriptions>)
  - [func \(s \*OAuthService\) Unsubscribe\(ctx context.Context, userID uuid.UUID, provider string\) \(subscriptiondomain.Subscription, error\)](<#OAuthService.Unsubscribe>)
- [type ProviderResolver](<#ProviderResolver>)
- [type RegistrationResult](<#RegistrationResult>)
- [type Service](<#Service>)
  - [func NewService\(users outbound.UserRepository, sessions outbound.SessionRepository, tokens outbound.VerificationTokenRepository, mailer outbound.Mailer, hasher password.Hasher, clock Clock, logger \*zap.Logger, cfg Config\) \*Service](<#NewService>)
  - [func \(s \*Service\) AdminChangeEmail\(ctx context.Context, userID uuid.UUID, email string, sendVerification bool\) \(EmailChangeResult, error\)](<#Service.AdminChangeEmail>)
  - [func \(s \*Service\) AdminResetPassword\(ctx context.Context, userID uuid.UUID, newPassword string\) \(userdomain.User, error\)](<#Service.AdminResetPassword>)
  - [func \(s \*Service\) AdminUpdateStatus\(ctx context.Context, userID uuid.UUID, status userdomain.Status\) \(userdomain.User, error\)](<#Service.AdminUpdateStatus>)
  - [func \(s \*Service\) ChangeEmail\(ctx context.Context, userID uuid.UUID, password string, email string\) \(EmailChangeResult, error\)](<#Service.ChangeEmail>)
  - [func \(s \*Service\) ChangePassword\(ctx context.Context, userID uuid.UUID, currentPassword, newPassword string\) \(userdomain.User, error\)](<#Service.ChangePassword>)
  - [func \(s \*Service\) Login\(ctx context.Context, email string, password string, meta Metadata\) \(LoginResult, error\)](<#Service.Login>)
  - [func \(s \*Service\) Logout\(ctx context.Context, sessionID uuid.UUID\) error](<#Service.Logout>)
  - [func \(s \*Service\) Register\(ctx context.Context, email string, password string\) \(RegistrationResult, error\)](<#Service.Register>)
  - [func \(s \*Service\) ResolveSession\(ctx context.Context, sessionID uuid.UUID\) \(userdomain.User, sessiondomain.Session, error\)](<#Service.ResolveSession>)
  - [func \(s \*Service\) VerifyEmail\(ctx context.Context, token string, meta Metadata\) \(VerificationResult, error\)](<#Service.VerifyEmail>)
- [type SubscriptionInitResult](<#SubscriptionInitResult>)
- [type SubscriptionOverview](<#SubscriptionOverview>)
- [type VerificationResult](<#VerificationResult>)


## Variables

<a name="ErrEmailAlreadyRegistered"></a>

```go
var (
    // ErrEmailAlreadyRegistered indicates the email is already in use
    ErrEmailAlreadyRegistered = errors.New("auth: email already registered")

    // ErrInvalidCredentials is returned when email or password do not match
    ErrInvalidCredentials = errors.New("auth: invalid credentials")

    // ErrAccountNotVerified signals that the account must confirm email before login
    ErrAccountNotVerified = errors.New("auth: account requires verification")

    // ErrVerificationTokenExpired indicates the verification token expired
    ErrVerificationTokenExpired = errors.New("auth: verification token expired")

    // ErrVerificationTokenUsed indicates the token has already been consumed
    ErrVerificationTokenUsed = errors.New("auth: verification token consumed")

    // ErrSessionNotFound is returned when the referenced session cannot be found
    ErrSessionNotFound = errors.New("auth: session not found")

    // ErrEmailUnchanged indicates the requested email matches the current value
    ErrEmailUnchanged = errors.New("auth: email unchanged")
)
```

<a name="ErrIdentityOwnershipConflict"></a>ErrIdentityOwnershipConflict is returned when attempting to reuse an identity owned by another user.

```go
var ErrIdentityOwnershipConflict = errors.New("auth: identity already linked to another user")
```

<a name="ErrOAuthEmailMissing"></a>ErrOAuthEmailMissing is returned when the provider payload does not include an email address

```go
var ErrOAuthEmailMissing = errors.New("auth: oauth email missing")
```

<a name="ErrProviderNotConfigured"></a>ErrProviderNotConfigured indicates the requested OAuth provider is unavailable

```go
var ErrProviderNotConfigured = errors.New("auth: oauth provider not configured")
```

<a name="ErrSubscriptionNotSupported"></a>ErrSubscriptionNotSupported indicates the provider does not support automated subscriptions yet.

```go
var ErrSubscriptionNotSupported = errors.New("auth: provider does not support subscriptions")
```

<a name="Clock"></a>
## type [Clock](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L23-L25>)

Clock abstracts time sourcing for deterministic testing

```go
type Clock interface {
    Now() time.Time
}
```

<a name="Config"></a>
## type [Config](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L28-L34>)

Config wires runtime options for the authentication service

```go
type Config struct {
    PasswordMinLength int
    SessionTTL        time.Duration
    VerificationTTL   time.Duration
    BaseURL           string
    CookieName        string
}
```

<a name="CookieConfig"></a>
## type [CookieConfig](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L25-L31>)

CookieConfig encapsulates browser cookie attributes enforced by the handler

```go
type CookieConfig struct {
    Domain   string
    Path     string
    Secure   bool
    HTTPOnly bool
    SameSite http.SameSite
}
```

<a name="EmailChangeResult"></a>
## type [EmailChangeResult](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L131-L134>)

EmailChangeResult conveys the outcome of an email update request

```go
type EmailChangeResult struct {
    User                userdomain.User
    VerificationExpires *time.Time
}
```

<a name="Handler"></a>
## type [Handler](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L35-L39>)

Handler exposes authentication endpoints backed by Service Use Register to mount the handler on the gin engine generated by oapi\-codegen

```go
type Handler struct {
    // contains filtered or unexported fields
}
```

<a name="NewHandler"></a>
### func [NewHandler](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L42>)

```go
func NewHandler(service *Service, oauth *OAuthService, cookies CookieConfig) *Handler
```

NewHandler constructs the HTTP handler

<a name="Handler.AdminResetUserPassword"></a>
### func \(\*Handler\) [AdminResetUserPassword](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L551>)

```go
func (h *Handler) AdminResetUserPassword(c *gin.Context, userID openapitypes.UUID)
```

AdminResetUserPassword handles PATCH /v1/admin/users/\{userId\}/password

<a name="Handler.AdminUpdateUserEmail"></a>
### func \(\*Handler\) [AdminUpdateUserEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L584>)

```go
func (h *Handler) AdminUpdateUserEmail(c *gin.Context, userID openapitypes.UUID)
```

AdminUpdateUserEmail handles PATCH /v1/admin/users/\{userId\}/email

<a name="Handler.AdminUpdateUserStatus"></a>
### func \(\*Handler\) [AdminUpdateUserStatus](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L631>)

```go
func (h *Handler) AdminUpdateUserStatus(c *gin.Context, userID openapitypes.UUID)
```

AdminUpdateUserStatus handles PATCH /v1/admin/users/\{userId\}/status

<a name="Handler.AuthorizeOAuth"></a>
### func \(\*Handler\) [AuthorizeOAuth](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L338>)

```go
func (h *Handler) AuthorizeOAuth(c *gin.Context, provider string)
```

AuthorizeOAuth handles POST /v1/oauth/\{provider\}/authorize

<a name="Handler.ChangeEmail"></a>
### func \(\*Handler\) [ChangeEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L207>)

```go
func (h *Handler) ChangeEmail(c *gin.Context)
```

ChangeEmail handles PATCH /v1/auth/email

<a name="Handler.ChangePassword"></a>
### func \(\*Handler\) [ChangePassword](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L174>)

```go
func (h *Handler) ChangePassword(c *gin.Context)
```

ChangePassword handles PATCH /v1/auth/password

<a name="Handler.ExchangeOAuth"></a>
### func \(\*Handler\) [ExchangeOAuth](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L390>)

```go
func (h *Handler) ExchangeOAuth(c *gin.Context, provider string)
```

ExchangeOAuth handles POST /v1/oauth/\{provider\}/exchange

<a name="Handler.GetCurrentUser"></a>
### func \(\*Handler\) [GetCurrentUser](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L162>)

```go
func (h *Handler) GetCurrentUser(c *gin.Context)
```

GetCurrentUser handles GET /v1/auth/me

<a name="Handler.ListIdentities"></a>
### func \(\*Handler\) [ListIdentities](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L250>)

```go
func (h *Handler) ListIdentities(c *gin.Context)
```

ListIdentities handles GET /v1/identities

<a name="Handler.ListServiceProviders"></a>
### func \(\*Handler\) [ListServiceProviders](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L272>)

```go
func (h *Handler) ListServiceProviders(c *gin.Context)
```

ListServiceProviders handles GET /v1/services

<a name="Handler.ListServiceSubscriptions"></a>
### func \(\*Handler\) [ListServiceSubscriptions](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L288>)

```go
func (h *Handler) ListServiceSubscriptions(c *gin.Context)
```

ListServiceSubscriptions handles GET /v1/services/subscriptions

<a name="Handler.Login"></a>
### func \(\*Handler\) [Login](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L111>)

```go
func (h *Handler) Login(c *gin.Context)
```

Login handles POST /v1/auth/login

<a name="Handler.Logout"></a>
### func \(\*Handler\) [Logout](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L139>)

```go
func (h *Handler) Logout(c *gin.Context)
```

Logout handles POST /v1/auth/logout

<a name="Handler.RegisterUser"></a>
### func \(\*Handler\) [RegisterUser](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L50>)

```go
func (h *Handler) RegisterUser(c *gin.Context)
```

RegisterUser handles POST /v1/users

<a name="Handler.SubscribeService"></a>
### func \(\*Handler\) [SubscribeService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L425>)

```go
func (h *Handler) SubscribeService(c *gin.Context, provider string)
```

SubscribeService handles POST /v1/services/\{provider\}/subscribe

<a name="Handler.SubscribeServiceExchange"></a>
### func \(\*Handler\) [SubscribeServiceExchange](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L495>)

```go
func (h *Handler) SubscribeServiceExchange(c *gin.Context, provider string)
```

SubscribeServiceExchange handles POST /v1/services/\{provider\}/subscribe/exchange

<a name="Handler.UnsubscribeService"></a>
### func \(\*Handler\) [UnsubscribeService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L309>)

```go
func (h *Handler) UnsubscribeService(c *gin.Context, provider string)
```

UnsubscribeService handles DELETE /v1/services/\{provider\}/subscription

<a name="Handler.VerifyEmail"></a>
### func \(\*Handler\) [VerifyEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/handler.go#L78>)

```go
func (h *Handler) VerifyEmail(c *gin.Context)
```

VerifyEmail handles POST /v1/auth/verify

<a name="LoginResult"></a>
## type [LoginResult](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L124-L128>)

LoginResult holds the session created for a user after authentication

```go
type LoginResult struct {
    User       userdomain.User
    Session    sessiondomain.Session
    CookieName string
}
```

<a name="Metadata"></a>
## type [Metadata](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L37-L40>)

Metadata captures request\-scoped attributes useful for auditing sessions

```go
type Metadata struct {
    ClientIP  string
    UserAgent string
}
```

<a name="OAuthService"></a>
## type [OAuthService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L40-L50>)

OAuthService orchestrates OAuth\-based authentication and identity persistence

```go
type OAuthService struct {
    // contains filtered or unexported fields
}
```

<a name="NewOAuthService"></a>
### func [NewOAuthService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L65>)

```go
func NewOAuthService(providers ProviderResolver, identities identityport.Repository, users outbound.UserRepository, sessions outbound.SessionRepository, serviceProviders outbound.ServiceProviderRepository, subscriptions outbound.SubscriptionRepository, clock Clock, logger *zap.Logger, cfg Config) *OAuthService
```

NewOAuthService assembles an OAuth service from persistence stores and provider registry.

<a name="OAuthService.AuthorizationURL"></a>
### func \(\*OAuthService\) [AuthorizationURL](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L92>)

```go
func (s *OAuthService) AuthorizationURL(ctx context.Context, provider string, req identityport.AuthorizationRequest) (identityport.AuthorizationResponse, error)
```

AuthorizationURL delegates to the provider to generate an authorization redirect payload

<a name="OAuthService.BeginSubscription"></a>
### func \(\*OAuthService\) [BeginSubscription](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L229>)

```go
func (s *OAuthService) BeginSubscription(ctx context.Context, user userdomain.User, provider string, req identityport.AuthorizationRequest) (SubscriptionInitResult, error)
```

BeginSubscription prepares a subscription flow for the specified provider.

<a name="OAuthService.CompleteSubscription"></a>
### func \(\*OAuthService\) [CompleteSubscription](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L281>)

```go
func (s *OAuthService) CompleteSubscription(ctx context.Context, user userdomain.User, provider string, code string, req identityport.ExchangeRequest) (subscriptiondomain.Subscription, identitydomain.Identity, error)
```

CompleteSubscription finalises a provider subscription by exchanging the OAuth code and persisting tokens.

<a name="OAuthService.Exchange"></a>
### func \(\*OAuthService\) [Exchange](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L106>)

```go
func (s *OAuthService) Exchange(ctx context.Context, provider string, code string, req identityport.ExchangeRequest, meta Metadata) (LoginResult, identitydomain.Identity, error)
```

Exchange processes the authorization code, persists the identity, and issues a session

<a name="OAuthService.LinkService"></a>
### func \(\*OAuthService\) [LinkService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L347>)

```go
func (s *OAuthService) LinkService(ctx context.Context, user userdomain.User, provider string, code string, req identityport.ExchangeRequest) (subscriptiondomain.Subscription, identitydomain.Identity, error)
```

LinkService completes an OAuth exchange for an authenticated user and records the subscription.

<a name="OAuthService.ListIdentities"></a>
### func \(\*OAuthService\) [ListIdentities](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L352>)

```go
func (s *OAuthService) ListIdentities(ctx context.Context, userID uuid.UUID) ([]identitydomain.Identity, error)
```

ListIdentities lists linked identities for the specified user

<a name="OAuthService.ListProviders"></a>
### func \(\*OAuthService\) [ListProviders](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L140>)

```go
func (s *OAuthService) ListProviders(ctx context.Context) ([]servicedomain.Provider, error)
```

ListProviders returns every service provider recorded in the catalog.

<a name="OAuthService.ListSubscriptions"></a>
### func \(\*OAuthService\) [ListSubscriptions](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L153>)

```go
func (s *OAuthService) ListSubscriptions(ctx context.Context, userID uuid.UUID) ([]SubscriptionOverview, error)
```

ListSubscriptions enumerates the user's subscriptions together with provider metadata.

<a name="OAuthService.Unsubscribe"></a>
### func \(\*OAuthService\) [Unsubscribe](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L181>)

```go
func (s *OAuthService) Unsubscribe(ctx context.Context, userID uuid.UUID, provider string) (subscriptiondomain.Subscription, error)
```

Unsubscribe revokes the user's access to the provider and clears stored credentials.

<a name="ProviderResolver"></a>
## type [ProviderResolver](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L35-L37>)

ProviderResolver exposes configured OAuth providers by name Implementations are expected to return providers for normalized \(lowercase\) identifiers

```go
type ProviderResolver interface {
    Provider(name string) (identityport.Provider, bool)
}
```

<a name="RegistrationResult"></a>
## type [RegistrationResult](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L109-L112>)

RegistrationResult conveys the outcome of a registration attempt

```go
type RegistrationResult struct {
    User                userdomain.User
    VerificationExpires time.Time
}
```

<a name="Service"></a>
## type [Service](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L45-L54>)

Service manages user registration, verification, and session issuance

```go
type Service struct {
    // contains filtered or unexported fields
}
```

<a name="NewService"></a>
### func [NewService](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L57>)

```go
func NewService(users outbound.UserRepository, sessions outbound.SessionRepository, tokens outbound.VerificationTokenRepository, mailer outbound.Mailer, hasher password.Hasher, clock Clock, logger *zap.Logger, cfg Config) *Service
```

NewService constructs an authentication service from its dependencies

<a name="Service.AdminChangeEmail"></a>
### func \(\*Service\) [AdminChangeEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L388>)

```go
func (s *Service) AdminChangeEmail(ctx context.Context, userID uuid.UUID, email string, sendVerification bool) (EmailChangeResult, error)
```

AdminChangeEmail updates a user's email and optionally issues a verification

<a name="Service.AdminResetPassword"></a>
### func \(\*Service\) [AdminResetPassword](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L365>)

```go
func (s *Service) AdminResetPassword(ctx context.Context, userID uuid.UUID, newPassword string) (userdomain.User, error)
```

AdminResetPassword sets a new password for the specified user

<a name="Service.AdminUpdateStatus"></a>
### func \(\*Service\) [AdminUpdateStatus](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L449>)

```go
func (s *Service) AdminUpdateStatus(ctx context.Context, userID uuid.UUID, status userdomain.Status) (userdomain.User, error)
```

AdminUpdateStatus changes the lifecycle status of a user and revokes sessions when necessary

<a name="Service.ChangeEmail"></a>
### func \(\*Service\) [ChangeEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L307>)

```go
func (s *Service) ChangeEmail(ctx context.Context, userID uuid.UUID, password string, email string) (EmailChangeResult, error)
```

ChangeEmail updates the email and re\-issues a verification token

<a name="Service.ChangePassword"></a>
### func \(\*Service\) [ChangePassword](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L280>)

```go
func (s *Service) ChangePassword(ctx context.Context, userID uuid.UUID, currentPassword, newPassword string) (userdomain.User, error)
```

ChangePassword updates the password after validating the current secret

<a name="Service.Login"></a>
### func \(\*Service\) [Login](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L236>)

```go
func (s *Service) Login(ctx context.Context, email string, password string, meta Metadata) (LoginResult, error)
```

Login validates credentials and issues a session cookie

<a name="Service.Logout"></a>
### func \(\*Service\) [Logout](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L477>)

```go
func (s *Service) Logout(ctx context.Context, sessionID uuid.UUID) error
```

Logout revokes the session referenced by the cookie

<a name="Service.Register"></a>
### func \(\*Service\) [Register](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L137>)

```go
func (s *Service) Register(ctx context.Context, email string, password string) (RegistrationResult, error)
```

Register creates a pending user and dispatches a verification email

<a name="Service.ResolveSession"></a>
### func \(\*Service\) [ResolveSession](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L488>)

```go
func (s *Service) ResolveSession(ctx context.Context, sessionID uuid.UUID) (userdomain.User, sessiondomain.Session, error)
```

ResolveSession fetches the user bound to the session identifier and ensures it is active

<a name="Service.VerifyEmail"></a>
### func \(\*Service\) [VerifyEmail](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L185>)

```go
func (s *Service) VerifyEmail(ctx context.Context, token string, meta Metadata) (VerificationResult, error)
```

VerifyEmail marks a token as consumed, activates the user, and returns a new session cookie

<a name="SubscriptionInitResult"></a>
## type [SubscriptionInitResult](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L53-L56>)

SubscriptionInitResult reports the outcome of initiating a subscription flow.

```go
type SubscriptionInitResult struct {
    Authorization *identityport.AuthorizationResponse
    Subscription  *subscriptiondomain.Subscription
}
```

<a name="SubscriptionOverview"></a>
## type [SubscriptionOverview](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/oauth_service.go#L59-L62>)

SubscriptionOverview couples a persisted subscription with its provider metadata.

```go
type SubscriptionOverview struct {
    Subscription subscriptiondomain.Subscription
    Provider     servicedomain.Provider
}
```

<a name="VerificationResult"></a>
## type [VerificationResult](<https://github.com/Epitech-2nd-Year-Projects/AREA/blob/main/server/internal/app/auth/service.go#L117-L121>)

VerificationResult represents a successful verification It includes the activated user and the associated session The caller is responsible for setting the resulting cookie using SessionID

```go
type VerificationResult struct {
    User       userdomain.User
    Session    sessiondomain.Session
    CookieName string
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
