services:
  server:
    build: ./server
    ports: ["8080:8080"]
    # TODO: Add an healthcheck to about.json

  #TODO: Add a client_mobile

  client_web:
    build:
      context: ./web
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-/v1}
        API_PROXY_TARGET: ${API_PROXY_TARGET:-http://server:8080/v1}
        CORS_ALLOWED_ORIGIN: ${CORS_ALLOWED_ORIGIN:-http://localhost:8081}
        NEXT_PUBLIC_API_MODE: ${NEXT_PUBLIC_API_MODE:-live}
    depends_on:
      # -client_mobile
      - server
    ports: ["8081:8081"]
    volumes:
      - apkshare:/app/public
    environment:
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-/v1}
      API_PROXY_TARGET: ${API_PROXY_TARGET:-http://server:8080/v1}
      CORS_ALLOWED_ORIGIN: ${CORS_ALLOWED_ORIGIN:-http://localhost:8081}
      NEXT_PUBLIC_API_MODE: ${NEXT_PUBLIC_API_MODE:-live}

volumes:
  apkshare:
